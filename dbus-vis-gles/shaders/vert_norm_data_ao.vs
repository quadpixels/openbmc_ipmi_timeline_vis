#version 300 es

in vec3 position;
in vec3 properties;  // normal_idx + color_idx + ao

out vec3 vert_color;
out vec3 normal;
out vec4 frag_pos_lightspace;

uniform mat4 M;
uniform mat4 V;
uniform mat4 P;

uniform mat4 lightPV;

vec3 default_palette[256] = vec3[](
    vec3(0.000,0.000,0.000),vec3(1.000,1.000,1.000),vec3(1.000,1.000,0.800),vec3(1.000,1.000,0.600),vec3(1.000,1.000,0.400),vec3(1.000,1.000,0.200),vec3(1.000,1.000,0.000),vec3(1.000,0.800,1.000),
    vec3(1.000,0.800,0.800),vec3(1.000,0.800,0.600),vec3(1.000,0.800,0.400),vec3(1.000,0.800,0.200),vec3(1.000,0.800,0.000),vec3(1.000,0.600,1.000),vec3(1.000,0.600,0.800),vec3(1.000,0.600,0.600),
    vec3(1.000,0.600,0.400),vec3(1.000,0.600,0.200),vec3(1.000,0.600,0.000),vec3(1.000,0.400,1.000),vec3(1.000,0.400,0.800),vec3(1.000,0.400,0.600),vec3(1.000,0.400,0.400),vec3(1.000,0.400,0.200),
    vec3(1.000,0.400,0.000),vec3(1.000,0.200,1.000),vec3(1.000,0.200,0.800),vec3(1.000,0.200,0.600),vec3(1.000,0.200,0.400),vec3(1.000,0.200,0.200),vec3(1.000,0.200,0.000),vec3(1.000,0.000,1.000),
    vec3(1.000,0.000,0.800),vec3(1.000,0.000,0.600),vec3(1.000,0.000,0.400),vec3(1.000,0.000,0.200),vec3(1.000,0.000,0.000),vec3(0.800,1.000,1.000),vec3(0.800,1.000,0.800),vec3(0.800,1.000,0.600),
    vec3(0.800,1.000,0.400),vec3(0.800,1.000,0.200),vec3(0.800,1.000,0.000),vec3(0.800,0.800,1.000),vec3(0.800,0.800,0.800),vec3(0.800,0.800,0.600),vec3(0.800,0.800,0.400),vec3(0.800,0.800,0.200),
    vec3(0.800,0.800,0.000),vec3(0.800,0.600,1.000),vec3(0.800,0.600,0.800),vec3(0.800,0.600,0.600),vec3(0.800,0.600,0.400),vec3(0.800,0.600,0.200),vec3(0.800,0.600,0.000),vec3(0.800,0.400,1.000),
    vec3(0.800,0.400,0.800),vec3(0.800,0.400,0.600),vec3(0.800,0.400,0.400),vec3(0.800,0.400,0.200),vec3(0.800,0.400,0.000),vec3(0.800,0.200,1.000),vec3(0.800,0.200,0.800),vec3(0.800,0.200,0.600),
    vec3(0.800,0.200,0.400),vec3(0.800,0.200,0.200),vec3(0.800,0.200,0.000),vec3(0.800,0.000,1.000),vec3(0.800,0.000,0.800),vec3(0.800,0.000,0.600),vec3(0.800,0.000,0.400),vec3(0.800,0.000,0.200),
    vec3(0.800,0.000,0.000),vec3(0.600,1.000,1.000),vec3(0.600,1.000,0.800),vec3(0.600,1.000,0.600),vec3(0.600,1.000,0.400),vec3(0.600,1.000,0.200),vec3(0.600,1.000,0.000),vec3(0.600,0.800,1.000),
    vec3(0.600,0.800,0.800),vec3(0.600,0.800,0.600),vec3(0.600,0.800,0.400),vec3(0.600,0.800,0.200),vec3(0.600,0.800,0.000),vec3(0.600,0.600,1.000),vec3(0.600,0.600,0.800),vec3(0.600,0.600,0.600),
    vec3(0.600,0.600,0.400),vec3(0.600,0.600,0.200),vec3(0.600,0.600,0.000),vec3(0.600,0.400,1.000),vec3(0.600,0.400,0.800),vec3(0.600,0.400,0.600),vec3(0.600,0.400,0.400),vec3(0.600,0.400,0.200),
    vec3(0.600,0.400,0.000),vec3(0.600,0.200,1.000),vec3(0.600,0.200,0.800),vec3(0.600,0.200,0.600),vec3(0.600,0.200,0.400),vec3(0.600,0.200,0.200),vec3(0.600,0.200,0.000),vec3(0.600,0.000,1.000),
    vec3(0.600,0.000,0.800),vec3(0.600,0.000,0.600),vec3(0.600,0.000,0.400),vec3(0.600,0.000,0.200),vec3(0.600,0.000,0.000),vec3(0.400,1.000,1.000),vec3(0.400,1.000,0.800),vec3(0.400,1.000,0.600),
    vec3(0.400,1.000,0.400),vec3(0.400,1.000,0.200),vec3(0.400,1.000,0.000),vec3(0.400,0.800,1.000),vec3(0.400,0.800,0.800),vec3(0.400,0.800,0.600),vec3(0.400,0.800,0.400),vec3(0.400,0.800,0.200),
    vec3(0.400,0.800,0.000),vec3(0.400,0.600,1.000),vec3(0.400,0.600,0.800),vec3(0.400,0.600,0.600),vec3(0.400,0.600,0.400),vec3(0.400,0.600,0.200),vec3(0.400,0.600,0.000),vec3(0.400,0.400,1.000),
    vec3(0.400,0.400,0.800),vec3(0.400,0.400,0.600),vec3(0.400,0.400,0.400),vec3(0.400,0.400,0.200),vec3(0.400,0.400,0.000),vec3(0.400,0.200,1.000),vec3(0.400,0.200,0.800),vec3(0.400,0.200,0.600),
    vec3(0.400,0.200,0.400),vec3(0.400,0.200,0.200),vec3(0.400,0.200,0.000),vec3(0.400,0.000,1.000),vec3(0.400,0.000,0.800),vec3(0.400,0.000,0.600),vec3(0.400,0.000,0.400),vec3(0.400,0.000,0.200),
    vec3(0.400,0.000,0.000),vec3(0.200,1.000,1.000),vec3(0.200,1.000,0.800),vec3(0.200,1.000,0.600),vec3(0.200,1.000,0.400),vec3(0.200,1.000,0.200),vec3(0.200,1.000,0.000),vec3(0.200,0.800,1.000),
    vec3(0.200,0.800,0.800),vec3(0.200,0.800,0.600),vec3(0.200,0.800,0.400),vec3(0.200,0.800,0.200),vec3(0.200,0.800,0.000),vec3(0.200,0.600,1.000),vec3(0.200,0.600,0.800),vec3(0.200,0.600,0.600),
    vec3(0.200,0.600,0.400),vec3(0.200,0.600,0.200),vec3(0.200,0.600,0.000),vec3(0.200,0.400,1.000),vec3(0.200,0.400,0.800),vec3(0.200,0.400,0.600),vec3(0.200,0.400,0.400),vec3(0.200,0.400,0.200),
    vec3(0.200,0.400,0.000),vec3(0.200,0.200,1.000),vec3(0.200,0.200,0.800),vec3(0.200,0.200,0.600),vec3(0.200,0.200,0.400),vec3(0.200,0.200,0.200),vec3(0.200,0.200,0.000),vec3(0.200,0.000,1.000),
    vec3(0.200,0.000,0.800),vec3(0.200,0.000,0.600),vec3(0.200,0.000,0.400),vec3(0.200,0.000,0.200),vec3(0.200,0.000,0.000),vec3(0.000,1.000,1.000),vec3(0.000,1.000,0.800),vec3(0.000,1.000,0.600),
    vec3(0.000,1.000,0.400),vec3(0.000,1.000,0.200),vec3(0.000,1.000,0.000),vec3(0.000,0.800,1.000),vec3(0.000,0.800,0.800),vec3(0.000,0.800,0.600),vec3(0.000,0.800,0.400),vec3(0.000,0.800,0.200),
    vec3(0.000,0.800,0.000),vec3(0.000,0.600,1.000),vec3(0.000,0.600,0.800),vec3(0.000,0.600,0.600),vec3(0.000,0.600,0.400),vec3(0.000,0.600,0.200),vec3(0.000,0.600,0.000),vec3(0.000,0.400,1.000),
    vec3(0.000,0.400,0.800),vec3(0.000,0.400,0.600),vec3(0.000,0.400,0.400),vec3(0.000,0.400,0.200),vec3(0.000,0.400,0.000),vec3(0.000,0.200,1.000),vec3(0.000,0.200,0.800),vec3(0.000,0.200,0.600),
    vec3(0.000,0.200,0.400),vec3(0.000,0.200,0.200),vec3(0.000,0.200,0.000),vec3(0.000,0.000,1.000),vec3(0.000,0.000,0.800),vec3(0.000,0.000,0.600),vec3(0.000,0.000,0.400),vec3(0.000,0.000,0.200),
    vec3(0.933,0.000,0.000),vec3(0.867,0.000,0.000),vec3(0.733,0.000,0.000),vec3(0.667,0.000,0.000),vec3(0.533,0.000,0.000),vec3(0.467,0.000,0.000),vec3(0.333,0.000,0.000),vec3(0.267,0.000,0.000),
    vec3(0.133,0.000,0.000),vec3(0.067,0.000,0.000),vec3(0.000,0.933,0.000),vec3(0.000,0.867,0.000),vec3(0.000,0.733,0.000),vec3(0.000,0.667,0.000),vec3(0.000,0.533,0.000),vec3(0.000,0.467,0.000),
    vec3(0.000,0.333,0.000),vec3(0.000,0.267,0.000),vec3(0.000,0.133,0.000),vec3(0.000,0.067,0.000),vec3(0.000,0.000,0.933),vec3(0.000,0.000,0.867),vec3(0.000,0.000,0.733),vec3(0.000,0.000,0.667),
    vec3(0.000,0.000,0.533),vec3(0.000,0.000,0.467),vec3(0.000,0.000,0.333),vec3(0.000,0.000,0.267),vec3(0.000,0.000,0.133),vec3(0.000,0.000,0.067),vec3(0.933,0.933,0.933),vec3(0.867,0.867,0.867),
    vec3(0.733,0.733,0.733),vec3(0.667,0.667,0.667),vec3(0.533,0.533,0.533),vec3(0.467,0.467,0.467),vec3(0.333,0.333,0.333),vec3(0.267,0.267,0.267),vec3(0.133,0.133,0.133),vec3(0.067,0.067,0.067)
);

vec3 default_normals[6] = vec3[](
    vec3(0, 0, 1), vec3(0, 0, -1),
    vec3(1, 0, 0), vec3(-1, 0, 0),
    vec3(0, 1, 0), vec3(0, -1, 0)
);

void main()
{
  gl_Position = P * V * M * vec4(position, 1.0f);
  vert_color = default_palette[int(properties.y)];
  normal     = default_normals[int(properties.x)];

  vec3 frag = vec3(M * vec4(position, 1.0f));
  frag_pos_lightspace = lightPV * vec4(frag, 1.0);
}